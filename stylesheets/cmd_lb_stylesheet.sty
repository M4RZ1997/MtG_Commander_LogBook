% ------------------------------------------------------------------------------------------------- %
% 								depotstyle.sty 	Marcel Zauder 23/03/2021							%
% Stylesheet by Marcel                                                                              %
% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% ---------------------------------------- User Credentials --------------------------------------- %
% PLEASE ADJUST
\newcommand{\name}{Zauder}
\newcommand{\surname}{Marcel Matti}
% ################################################################################################# %
% ----------------------------------------- Miscellaneous ----------------------------------------- %
\usepackage[usegeometry]{typearea}% load before geometry
\usepackage{geometry}
\usepackage[T1]{fontenc}
\usepackage{reledmac} % for enumerating pages
\usepackage{changepage} % for adjustwidth/indent
\usepackage{paralist} % for enumerating
\usepackage{hyperref}
\usepackage{datatool} % for database
\usepackage{xstring}
% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% ------------------------------------------- Geometry -------------------------------------------- %
\newgeometry{
	hmargin=2.5cm,
	bottom=25mm,
	height=150mm,
	includehead,
	headsep = 30pt,
	textheight= 630pt
}
% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% --------------------------------------------- Math ---------------------------------------------- %
\usepackage{amsmath}
\usepackage{scalerel}
\usepackage{xfp}
\usepackage[np, autolanguage]{numprint}
% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% --------------------------------------- Computer Science ---------------------------------------- %
\usepackage{minted} % nice code snippet preview; NEEDS PYTHON pygmentize package
% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% -------------------------------------------- Tables --------------------------------------------- %
\usepackage{colortbl}
\usepackage{pgfplotstable}
\usepackage{multirow}
\usepackage{array, boldline, makecell, booktabs}
% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% ---------------------------------------- PGF/Tikz-Plots ----------------------------------------- %
\usepackage{pgfplots}
\usepackage{tikz}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric, arrows}
\usetikzlibrary{calc}
\usepackage{pgf-pie}

% ## Nice Arrow ## %
\tikzstyle{arrow} = [thick,->,>=stealth]
% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% --------------------------------------- Debugging Tools ----------------------------------------- %
\usepackage{layout}
%\usepackage{showframe}
% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% ------------------------------------------ Page Style ------------------------------------------- %
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyheadoffset{0pt}
\renewcommand{\headrulewidth}{0.4pt}
\fancyfoot[C]{\thepage}
\renewcommand{\footrulewidth}{0.4pt}
% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% ------------------------------------------- MARZColor ------------------------------------------- %
\usepackage{xcolor}
\definecolor{MarzDarkBlue}{rgb}{0.1, 0, 0.2}
\definecolor{MarzBlue}{rgb}{0.1, 0.1, 0.5}
\definecolor{MarzRoyal}{rgb}{0.2, 0.2, 0.8}
\definecolor{MarzGreen}{rgb}{0, 0.4, 0}
\definecolor{MarzPurple}{rgb}{0.5, 0, 0.5}
\definecolor{MarzGold}{rgb}{1.0, 0.84, 0}
\definecolor{MarzRed}{rgb}{1.0, 0, 0}
\definecolor{MarzDarkRed}{rgb}{0.75, 0, 0}
\definecolor{MarzOrange}{rgb}{1, 0.6, 0}

% ########## Text-Color Changer ######### %
\newcommand{\changetextcolor}[2]{{\color{#1} #2}}
% ####################################### %

% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% ---------------------------------------- New Commands ------------------------------------------- %

% #### New Column-Types for Tabulars #### %
%\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}} % Middle-Top
%\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}} % Middle-Middle
% ####################################### %

% ######## Portfolio DataBase ######## %
\newcommand*{\addoldportfolioentry}[9]{%
  \DTLnewrow{oldportfolioentry}%
  \DTLnewdbentry{oldportfolioentry}{Name}{#1}%
  \DTLnewdbentry{oldportfolioentry}{Wkn}{#2}%
  \DTLnewdbentry{oldportfolioentry}{EntryPrice}{#3}%
  \DTLnewdbentry{oldportfolioentry}{Amount}{#4}%
  \DTLnewdbentry{oldportfolioentry}{InitialTotal}{\fpeval{round(#3*#4,2)}}%
  \DTLnewdbentry{oldportfolioentry}{JanuaryPrice}{#5}%
  \DTLnewdbentry{oldportfolioentry}{FebruaryPrice}{#6}%
  \DTLnewdbentry{oldportfolioentry}{MarchPrice}{#7}%
  \DTLnewdbentry{oldportfolioentry}{AprilPrice}{#8}%
  \DTLnewdbentry{oldportfolioentry}{MayPrice}{#9}%
}
\newcommand{\secaddoldportfolioentry}[7]{
  \DTLnewdbentry{oldportfolioentry}{JunePrice}{#1}%
  \DTLnewdbentry{oldportfolioentry}{JulyPrice}{#2}%
  \DTLnewdbentry{oldportfolioentry}{AugustPrice}{#3}%
  \DTLnewdbentry{oldportfolioentry}{SeptemberPrice}{#4}%
  \DTLnewdbentry{oldportfolioentry}{OctoberPrice}{#5}%
  \DTLnewdbentry{oldportfolioentry}{NovemberPrice}{#6}%
  \DTLnewdbentry{oldportfolioentry}{DecemberPrice}{#7}%
}

% ######## Portfolio DataBase ######## %
\newcommand*{\addportfolioentry}[4]{%
  \DTLnewrow{portfolioentry}%
  \DTLnewdbentry{portfolioentry}{Name}{#1}%
  \DTLnewdbentry{portfolioentry}{Wkn}{#2}%
  \DTLnewdbentry{portfolioentry}{EntryPrice}{#3}%
  \DTLnewdbentry{portfolioentry}{Amount}{#4}%
  \DTLnewdbentry{portfolioentry}{InitialTotal}{\fpeval{round(#3*#4,2)}}%
  \DTLnewdbentry{portfolioentry}{JanuaryPrice}{0}%
  \DTLnewdbentry{portfolioentry}{FebruaryPrice}{0}%
  \DTLnewdbentry{portfolioentry}{MarchPrice}{0}%
  \DTLnewdbentry{portfolioentry}{AprilPrice}{0}%
  \DTLnewdbentry{portfolioentry}{MayPrice}{0}%
  \DTLnewdbentry{portfolioentry}{JunePrice}{0}%
  \DTLnewdbentry{portfolioentry}{JulyPrice}{0}%
  \DTLnewdbentry{portfolioentry}{AugustPrice}{0}%
  \DTLnewdbentry{portfolioentry}{SeptemberPrice}{0}%
  \DTLnewdbentry{portfolioentry}{OctoberPrice}{0}%
  \DTLnewdbentry{portfolioentry}{NovemberPrice}{0}%
  \DTLnewdbentry{portfolioentry}{DecemberPrice}{0}%
}

\newcommand*\dtlupdatecounterincurrentrow
  {\dtlupdateentryincurrentrow{counter}}

% Update single value with key WKN
\newcommand*{\updateportfolioentry}[3]{
	\dtlgetrowforvalue{portfolioentry}{\dtlcolumnindex{portfolioentry}{Wkn}}{#1}
	\dtlreplaceentryincurrentrow{#3}{\dtlcolumnindex{portfolioentry}{#2}}
	\dtlrecombine
}


% Update all
\newcommand*{\updateallentries}[6]{
	\ifx&#2&\else\updateportfolioentry{A1C5E7}{#1}{#2}\fi
	\ifx&#3&\else\updateportfolioentry{A113FM}{#1}{#3}\fi
	\ifx&#4&\else\updateportfolioentry{DBX0BT}{#1}{#4}\fi
	\ifx&#5&\else\updateportfolioentry{LYX0GH}{#1}{#5}\fi
	\ifx&#6&\else\updateportfolioentry{LYX01X}{#1}{#6}\fi
}

% Calculate Percentages
\newcommand{\calculatePercentages}[2]{
	\DTLforeach*{portfolioentry}{\thisWKN=Wkn, \thisAmount=Amount, \thisNewPrice=#2}{
		\ifnum\value{DTLrowi}=1 {
			\FPset{percentageone}{0}
			\FPeval{percentageone}{round((\thisAmount*\thisNewPrice)/#1*100,2)}
			\xdef\percentageone{\percentageone}\relax
			\renewcommand{\nameone}{\thisWKN}
			\xdef\nameone{\nameone}\relax
		}\fi
		\ifnum\value{DTLrowi}=2 {
			\FPset{percentagetwo}{0}
			\FPeval{percentagetwo}{round((\thisAmount*\thisNewPrice)/#1*100,2)}
			\xdef\percentagetwo{\percentagetwo}\relax
			\renewcommand{\nametwo}{\thisWKN}
			\xdef\nametwo{\nametwo}\relax
		}\fi
		\ifnum\value{DTLrowi}=3 {
			\FPset{percentagethree}{0}
			\FPeval{percentagethree}{round((\thisAmount*\thisNewPrice)/#1*100,2)}
			\xdef\percentagethree{\percentagethree}\relax
			\renewcommand{\namethree}{\thisWKN}
			\xdef\namethree{\namethree}\relax
		}\fi
		\ifnum\value{DTLrowi}=4 {
			\FPset{percentagefour}{0}
			\FPeval{percentagefour}{round((\thisAmount*\thisNewPrice)/#1*100,2)}
			\xdef\percentagefour{\percentagefour}\relax
			\renewcommand{\namefour}{\thisWKN}
			\xdef\namefour{\namefour}\relax
		}\fi
		\ifnum\value{DTLrowi}=5 {
			\FPset{percentagefive}{0}
			\FPeval{percentagefive}{round((\thisAmount*\thisNewPrice)/#1*100,2)}
			\xdef\percentagefive{\percentagefive}\relax
			\renewcommand{\namefive}{\thisWKN}
			\xdef\namefive{\namefive}\relax
		}\fi
	}
}
% ####################################### %
\newcommand{\calculatetotal}[2]{
	\FPset{\temp}{0}
	\DTLforeach*{portfolioentry}{\thisWKN=Wkn, \thisAmount=Amount, \thisNewPrice=#1}{
		\FPeval{temp}{temp+(\thisNewPrice*\thisAmount)}
		\xdef#2{\temp}
	}
}

% ####################################### %
\newcommand{\accumulatetotals}{
	\FPset{\accinitialPrice}{0}
	\FPset{\accjanuaryPrice}{0}
	\FPset{\accfebruaryPrice}{0}
	\FPset{\accmarchPrice}{0}
	\FPset{\accaprilPrice}{0}
	\FPset{\accmayPrice}{0}
	\FPset{\accjunePrice}{0}
	\FPset{\accjulyPrice}{0}
	\FPset{\accaugustPrice}{0}
	\FPset{\accseptemberPrice}{0}
	\FPset{\accoctoberPrice}{0}
	\FPset{\accnovemberPrice}{0}
	\FPset{\accdecemberPrice}{0}
	
	\foreach \x in {1,...,5}
    		\loadprices{oldportfolioentry}{\x}
    		\DTLgetvalue{\amount}{oldportfolioentry}{\x}{\dtlcolumnindex{oldportfolioentry}{Amount}}
    		\FPeval{\accinitialPrice}{\accinitialPrice + \initialPrice * \amount}
    		\xdef\accinitialPrice{\accinitialPrice}
    		\FPeval{\accjanuaryPrice}{\accjanuaryPrice + \januaryPrice * \amount}
    		\xdef\accjanuaryPrice{\accjanuaryPrice}
    		\FPeval{\accfebruaryPrice}{\accfebruaryPrice + \februaryPrice * \amount}
    		\xdef\accfebruaryPrice{\accfebruaryPrice}
    		\FPeval{\accmarchPrice}{\accmarchPrice + \marchPrice * \amount}
    		\xdef\accmarchPrice{\accmarchPrice}
    		\FPeval{\accaprilPrice}{\accaprilPrice + \aprilPrice * \amount}
    		\xdef\accaprilPrice{\accaprilPrice}
    		\FPeval{\accmayPrice}{\accmayPrice + \mayPrice * \amount}
    		\xdef\accmayPrice{\accmayPrice}
    		\FPeval{\accjunePrice}{\accjunePrice + \junePrice * \amount}
    		\xdef\accjunePrice{\accjunePrice}
    		\FPeval{\accjulyPrice}{\accjulyPrice + \julyPrice * \amount}
    		\xdef\accjulyPrice{\accjulyPrice}
    		\FPeval{\accaugustPrice}{\accaugustPrice + \augustPrice * \amount}
    		\xdef\accaugustPrice{\accaugustPrice}
    		\FPeval{\accseptemberPrice}{\accseptemberPrice + \septemberPrice * \amount}
    		\xdef\accseptemberPrice{\accseptemberPrice}
    		\FPeval{\accoctoberPrice}{\accoctoberPrice + \octoberPrice * \amount}
    		\xdef\accoctoberPrice{\accoctoberPrice}
    		\FPeval{\accnovemberPrice}{\accnovemberPrice + \novemberPrice * \amount}
    		\xdef\accnovemberPrice{\accnovemberPrice}
    		\FPeval{\accdecemberPrice}{\accdecemberPrice + \decemberPrice * \amount}
    		\xdef\accdecemberPrice{\accdecemberPrice};
}

% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% ------------------------------------------ Variables -------------------------------------------- %
\def\a1c5e7{1}
\def\a113fm{2}
\def\dbx0bt{3}
\def\lyx0gh{4}
\def\lyx01x{5}

\newcommand{\Year}[1]{
	\ifx\xyear\undefined%
		\newcommand{\tyear}{#1}%
		\newcommand{\xyear}{#1~}%
	\else%
		\PackageWarning{M4RZStyleCorp}{The year is only set once for the whole document!}%
	\fi%
}
% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %